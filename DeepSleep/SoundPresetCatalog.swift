import Foundation

struct SoundPresetCatalog {
    
    // MARK: - 13ê°œ ì¹´í…Œê³ ë¦¬ ì •ì˜ (ê¸°ì¡´ 11ê°œ + ìƒˆë¡œ ì¶”ê°€ 2ê°œ)
    
    /// ì¹´í…Œê³ ë¦¬ë³„ ì´ëª¨ì§€ (UI í‘œì‹œìš©)
    static let categoryEmojis: [String] = [
        "ğŸ±",  // ê³ ì–‘ì´
        "ğŸ’¨",  // ë°”ëŒ
        "ğŸŒ™",  // ë°¤
        "ğŸ”¥",  // ë¶ˆ1
        "ğŸŒ§ï¸", // ë¹„
        "ğŸï¸", // ì‹œëƒ‡ë¬¼
        "âœï¸",  // ì—°í•„
        "ğŸŒŒ",  // ìš°ì£¼
        "ğŸŒ€",  // ì¿¨ë§íŒ¬
        "âŒ¨ï¸",  // í‚¤ë³´ë“œ
        "ğŸŒŠ",  // íŒŒë„
        "ğŸ¦",  // ìƒˆ (ìƒˆë¡œ ì¶”ê°€)
        "â„ï¸"   // ë°œê±¸ìŒ-ëˆˆ (ìƒˆë¡œ ì¶”ê°€)
    ]
    
    /// ì¹´í…Œê³ ë¦¬ë³„ ì´ë¦„
    static let categoryNames: [String] = [
        "ê³ ì–‘ì´",
        "ë°”ëŒ",
        "ë°¤",
        "ë¶ˆ1",
        "ë¹„",
        "ì‹œëƒ‡ë¬¼",
        "ì—°í•„",
        "ìš°ì£¼",
        "ì¿¨ë§íŒ¬",
        "í‚¤ë³´ë“œ",
        "íŒŒë„",
        "ìƒˆ",
        "ë°œê±¸ìŒ-ëˆˆ"
    ]
    
    /// ì´ëª¨ì§€ + ì´ë¦„ ì¡°í•© (ìŠ¬ë¼ì´ë” ë¼ë²¨ìš©)
    static let displayLabels: [String] = [
        "ğŸ± ê³ ì–‘ì´",
        "ğŸ’¨ ë°”ëŒ",
        "ğŸŒ™ ë°¤",
        "ğŸ”¥ ë¶ˆ1",
        "ğŸŒ§ï¸ ë¹„",
        "ğŸï¸ ì‹œëƒ‡ë¬¼",
        "âœï¸ ì—°í•„",
        "ğŸŒŒ ìš°ì£¼",
        "ğŸŒ€ ì¿¨ë§íŒ¬",
        "âŒ¨ï¸ í‚¤ë³´ë“œ",
        "ğŸŒŠ íŒŒë„",
        "ğŸ¦ ìƒˆ",
        "â„ï¸ ë°œê±¸ìŒ-ëˆˆ"
    ]
    
    // MARK: - ì¹´í…Œê³ ë¦¬ë³„ íŒŒì¼ ì •ë³´
    
    /// ê° ì¹´í…Œê³ ë¦¬ì˜ ì‚¬ìš© ê°€ëŠ¥í•œ íŒŒì¼ë“¤
    static let categoryFiles: [[String]] = [
        ["ê³ ì–‘ì´.mp3"],                        // 0: ğŸ± ê³ ì–‘ì´ (1ê°œ)
        ["ë°”ëŒ.mp3", "ë°”ëŒ2.mp3"],              // 1: ğŸ’¨ ë°”ëŒ (2ê°œ ë²„ì „)
        ["ë°¤.mp3", "ë°¤2.mp3"],                  // 2: ğŸŒ™ ë°¤ (2ê°œ ë²„ì „)
        ["ë¶ˆ1.mp3"],                           // 3: ğŸ”¥ ë¶ˆ1 (1ê°œ)
        ["ë¹„.mp3", "ë¹„-ì°½ë¬¸.mp3"],               // 4: ğŸŒ§ï¸ ë¹„ (2ê°œ ë²„ì „)
        ["ì‹œëƒ‡ë¬¼.mp3"],                        // 5: ğŸï¸ ì‹œëƒ‡ë¬¼ (1ê°œ)
        ["ì—°í•„.mp3"],                          // 6: âœï¸ ì—°í•„ (1ê°œ)
        ["ìš°ì£¼.mp3"],                          // 7: ğŸŒŒ ìš°ì£¼ (1ê°œ)
        ["ì¿¨ë§íŒ¬.mp3"],                        // 8: ğŸŒ€ ì¿¨ë§íŒ¬ (1ê°œ)
        ["í‚¤ë³´ë“œ1.mp3", "í‚¤ë³´ë“œ2.mp3"],         // 9: âŒ¨ï¸ í‚¤ë³´ë“œ (2ê°œ ë²„ì „)
        ["íŒŒë„.mp3", "íŒŒë„2.mp3"],              // 10: ğŸŒŠ íŒŒë„ (2ê°œ ë²„ì „)
        ["ìƒˆ.mp3", "ìƒˆ-ë¹„.mp3"],                // 11: ğŸ¦ ìƒˆ (2ê°œ ë²„ì „)
        ["ë°œê±¸ìŒ-ëˆˆ.mp3", "ë°œê±¸ìŒ-ëˆˆ2.mp3"]      // 12: â„ï¸ ë°œê±¸ìŒ-ëˆˆ (2ê°œ ë²„ì „)
    ]
    
    /// ê° ì¹´í…Œê³ ë¦¬ì˜ ê¸°ë³¸ ì„ íƒ íŒŒì¼ ì¸ë±ìŠ¤
    static let defaultVersions: [Int] = [
        0,  // ê³ ì–‘ì´: ê³ ì–‘ì´.mp3
        0,  // ë°”ëŒ: ë°”ëŒ.mp3 (ê¸°ë³¸), ë°”ëŒ2.mp3ëŠ” ë²„ì „2
        0,  // ë°¤: ë°¤.mp3 (ê¸°ë³¸), ë°¤2.mp3ëŠ” ë²„ì „2
        0,  // ë¶ˆ1: ë¶ˆ1.mp3
        0,  // ë¹„: ë¹„.mp3 (ê¸°ë³¸), ë¹„-ì°½ë¬¸.mp3ëŠ” ë²„ì „2
        0,  // ì‹œëƒ‡ë¬¼: ì‹œëƒ‡ë¬¼.mp3
        0,  // ì—°í•„: ì—°í•„.mp3
        0,  // ìš°ì£¼: ìš°ì£¼.mp3
        0,  // ì¿¨ë§íŒ¬: ì¿¨ë§íŒ¬.mp3
        0,  // í‚¤ë³´ë“œ: í‚¤ë³´ë“œ1.mp3 (ê¸°ë³¸), í‚¤ë³´ë“œ2.mp3ëŠ” ë²„ì „2
        0,  // íŒŒë„: íŒŒë„.mp3 (ê¸°ë³¸), íŒŒë„2.mp3ëŠ” ë²„ì „2
        0,  // ìƒˆ: ìƒˆ.mp3 (ê¸°ë³¸), ìƒˆ-ë¹„.mp3ëŠ” ë²„ì „2
        0   // ë°œê±¸ìŒ-ëˆˆ: ë°œê±¸ìŒ-ëˆˆ.mp3 (ê¸°ë³¸), ë°œê±¸ìŒ-ëˆˆ2.mp3ëŠ” ë²„ì „2
    ]
    
    // MARK: - ê¸°ì¡´ í˜¸í™˜ì„± (ì„ì‹œ)
    
    /// ê¸°ì¡´ A-L ë¼ë²¨ê³¼ì˜ í˜¸í™˜ì„± ìœ ì§€ (Migration ìš©ë„)
    @available(*, deprecated, message: "Use displayLabels instead")
    static let labels: [String] = categoryNames
    
    // MARK: - ìœ í‹¸ë¦¬í‹° ë©”ì„œë“œ
    
    /// ì´ ì¹´í…Œê³ ë¦¬ ê°œìˆ˜
    static var categoryCount: Int {
        return categoryNames.count
    }
    
    /// íŠ¹ì • ì¸ë±ìŠ¤ì˜ ì™„ì „í•œ ì •ë³´
    static func getCategoryInfo(at index: Int) -> (emoji: String, name: String, files: [String], defaultIndex: Int)? {
        guard index >= 0, index < categoryCount else { return nil }
        
        return (
            emoji: categoryEmojis[index],
            name: categoryNames[index],
            files: categoryFiles[index],
            defaultIndex: defaultVersions[index]
        )
    }
    
    /// ì¹´í…Œê³ ë¦¬ì— ì—¬ëŸ¬ ë²„ì „ì´ ìˆëŠ”ì§€ í™•ì¸
    static func hasMultipleVersions(at index: Int) -> Bool {
        guard index >= 0, index < categoryFiles.count else { return false }
        return categoryFiles[index].count > 1
    }
    
    /// íŠ¹ì • ì¹´í…Œê³ ë¦¬ì˜ ë²„ì „ ê°œìˆ˜
    static func getVersionCount(at index: Int) -> Int {
        guard index >= 0, index < categoryFiles.count else { return 0 }
        return categoryFiles[index].count
    }
    
    /// ë²„ì „ ì´ë¦„ ìƒì„± (ì˜ˆ: "í‚¤ë³´ë“œ1", "í‚¤ë³´ë“œ2")
    static func getVersionName(categoryIndex: Int, versionIndex: Int) -> String {
        guard let info = getCategoryInfo(at: categoryIndex),
              versionIndex >= 0, versionIndex < info.files.count else {
            return "Unknown"
        }
        
        let fileName = info.files[versionIndex]
        return fileName.replacingOccurrences(of: ".mp3", with: "")
    }
    
    /// ì¹´í…Œê³ ë¦¬ëª…ìœ¼ë¡œ ì¸ë±ìŠ¤ ì°¾ê¸°
    static func findCategoryIndex(by name: String) -> Int? {
        if let index = categoryNames.firstIndex(of: name) {
            return index
        }
        
        // ì´ëª¨ì§€ë¡œë„ ì°¾ê¸°
        if let index = categoryEmojis.firstIndex(of: name) {
            return index
        }
        
        return nil
    }
    
    // MARK: - í”„ë¦¬ì…‹ í…œí”Œë¦¿
    
    /// ê¸°ë³¸ í”„ë¦¬ì…‹ (ëª¨ë“  ë³¼ë¥¨ 0)
    static let defaultPreset: [Float] = Array(repeating: 0.0, count: categoryCount)
    
    /// ìƒ˜í”Œ í”„ë¦¬ì…‹ë“¤
    static let samplePresets: [String: [Float]] = [
        "ğŸŒ§ï¸ ë¹—ì†Œë¦¬ ì§‘ì¤‘": [0, 0, 0, 0, 80, 0, 0, 0, 0, 0, 30, 0, 0],      // ë¹„ + íŒŒë„
        "ğŸ”¥ ë”°ëœ»í•œ ë°¤": [0, 20, 60, 70, 0, 0, 0, 40, 0, 0, 0, 0, 0],        // ë°”ëŒ + ë°¤ + ë¶ˆ1 + ìš°ì£¼
        "âŒ¨ï¸ ì‘ì—… ì§‘ì¤‘": [0, 0, 0, 0, 0, 0, 50, 0, 40, 80, 0, 0, 0],        // ì—°í•„ + ì¿¨ë§íŒ¬ + í‚¤ë³´ë“œ
        "ğŸŒ™ ê¹Šì€ ìˆ˜ë©´": [0, 30, 90, 20, 0, 40, 0, 70, 0, 0, 0, 0, 0],       // ë°”ëŒ + ë°¤ + ë¶ˆ1 + ì‹œëƒ‡ë¬¼ + ìš°ì£¼
        "ğŸ± í‰í™”ë¡œìš´ ì˜¤í›„": [60, 0, 30, 0, 20, 60, 0, 0, 0, 0, 0, 0, 0],    // ê³ ì–‘ì´ + ë°¤ + ë¹„ + ì‹œëƒ‡ë¬¼
        "ğŸŒŠ ìì—°ì˜ ì†Œë¦¬": [40, 50, 0, 0, 30, 80, 0, 0, 0, 0, 70, 40, 0]     // ê³ ì–‘ì´ + ë°”ëŒ + ë¹„ + ì‹œëƒ‡ë¬¼ + íŒŒë„ + ìƒˆ
    ]
    
    // MARK: - AI ì¶”ì²œì„ ìœ„í•œ ì¹´í…Œê³ ë¦¬ ì„¤ëª… (ì‹¬ë¦¬í•™ì  íš¨ê³¼ í¬í•¨)
    
    /// AIê°€ í”„ë¦¬ì…‹ ì¶”ì²œí•  ë•Œ ì‚¬ìš©í•  ì¹´í…Œê³ ë¦¬ ì„¤ëª… (ì‹¬ë¦¬í•™ì  íš¨ê³¼ í¬í•¨)
    static let categoryDescriptions: [String] = [
        "ê³ ì–‘ì´: ê°€ê¹Œì´ì„œ ê³¨ê³¨ëŒ€ëŠ” ì‘ì€ ì†Œë¦¬. ì˜¥ì‹œí† ì‹  ë¶„ë¹„ ì´‰ì§„ìœ¼ë¡œ ì• ì°©ê°ê³¼ í¸ì•ˆí•¨ ì œê³µ",
        "ë°”ëŒ: ìì—°ìŠ¤ëŸ¬ìš´ ë°”ëŒ ì†Œë¦¬ (V1), ë” ì•½í•˜ê³  ë‚®ì€ ìŒì˜ ë°”ëŒ (V2). ììœ¨ì‹ ê²½ê³„ ì•ˆì •í™”ì™€ ìŠ¤íŠ¸ë ˆìŠ¤ í˜¸ë¥´ëª¬ ê°ì†Œ íš¨ê³¼",
        "ë°¤: í•œêµ­ì˜ ì—¬ë¦„ë°¤ ê·€ëšœë¼ë¯¸ ì†Œë¦¬ (V1), ë” ë©€ë¦¬ì„œ ë²Œë ˆ ìš°ëŠ” ì†Œë¦¬ (V2). ìˆ˜ë©´ í˜¸ë¥´ëª¬ ë©œë¼í† ë‹Œ ë¶„ë¹„ ì´‰ì§„",
        "ë¶ˆ1: ë¶ˆ íƒ€ëŠ” ì†Œë¦¬ë¥¼ ê°€ê¹Œì´ì„œ ë…¹ìŒ. 1/f ì¡ìŒìœ¼ë¡œ ë‡ŒíŒŒ ì•ŒíŒŒíŒŒ ì¦ê°€ì™€ ê¹Šì€ ì´ì™„",
        "ë¹„: ì§‘ ë‚´ë¶€ì—ì„œ ì°½ë¬¸ ì—´ê³  ë“£ëŠ” ê°•í•œ ë¹„ì†Œë¦¬ (V1)ì™€ ì°½ë¬¸ í†¡í†¡ ì†Œë¦¬ (V2). ë„íŒŒë¯¼ ì¡°ì ˆê³¼ ì§‘ì¤‘ë ¥ í–¥ìƒ",
        "ì‹œëƒ‡ë¬¼: ì¡°ìš©í•œ ì‹œëƒ‡ë¬¼ì„ ê°€ê¹Œì´ì„œ ì°ì€ ë¬¼ íë¥´ëŠ” ì†Œë¦¬. ë¶€êµê°ì‹ ê²½ í™œì„±í™”ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ ì™„í™”",
        "ì—°í•„: ì¢…ì´ì— ê°€ë³ê²Œ ì˜ì–´ ì“°ëŠ” ìŠ¥ìŠ¥ ì†Œë¦¬. ASMR íš¨ê³¼ë¡œ ì§‘ì¤‘ë ¥ê³¼ ì°½ì˜ì„± ì¦ì§„",
        "ìš°ì£¼: ë†’ì€ ìŒì˜ ì˜ë¯¸ì‹¬ì¥í•œ ì‚¬ìš´ë“œ (20ì´ˆ ì´ë‚´ ê¶Œì¥). ì‹ ê²½ê°€ì†Œì„± ì´‰ì§„ê³¼ ê¹Šì€ ëª…ìƒ ìœ ë„",
        "ì¿¨ë§íŒ¬: ì˜›ë‚  ëƒ‰ì¥ê³  íŒ¬ ì†Œë¦¬. ì¼ì •í•œ ì£¼íŒŒìˆ˜ë¡œ ì¸ì§€ ë¶€í•˜ ê°ì†Œì™€ ë°°ê²½ ì°¨ìŒ íš¨ê³¼",
        "í‚¤ë³´ë“œ: ì²­ì¶•í‚¤ë³´ë“œ ì²œì²œíˆ (V1), ì˜›ë‚ í‚¤ë³´ë“œ ë¹ ë¥¸ ì—…ë¬´ìš© (V2). ì‘ì—… ë¦¬ë“¬ê°ê³¼ ì§‘ì¤‘ ìƒíƒœ ìœ ì§€",
        "íŒŒë„: 1.5ë¯¸í„° ìˆ˜ì‹¬ ì”ì”í•œ íŒŒë„ (V1), í•´ë³€ê°€ íŒŒë„ ë°”ìŠ¤ë¼ì§€ëŠ” íƒ„ì‚° ì†Œë¦¬ (V2). ë°±ìƒ‰ì†ŒìŒ íš¨ê³¼ë¡œ ì‹ ê²½ ì•ˆì •ê³¼ ìˆ˜ë©´ ìœ ë„",
        "ìƒˆ: ì•„ì¹¨ ìƒˆê°€ ì§¹ì§¹ëŒ€ëŠ” ì†Œë¦¬ (V1), ì•½í•œ ë¹„ì˜¤ëŠ” ë‚  ì•„ì¹¨ ë©€ë¦¬ì„œ ìƒˆë“¤ ì†Œë¦¬ (V2). ì„¸ë¡œí† ë‹Œ ë¶„ë¹„ë¡œ ê¸°ë¶„ ê°œì„ ê³¼ í™œë ¥ ì¦ì§„",
        "ë°œê±¸ìŒ-ëˆˆ: ì–•ì€ ëˆˆì„ ë¹ ë¥´ê²Œ ê±·ëŠ” ì†Œë¦¬ (V1), ê¹Šì€ ëˆˆì„ ì²œì²œíˆ ê±·ëŠ” ì†Œë¦¬ (V2). ë¦¬ë“¬ê° ìˆëŠ” ìì—°ìŒìœ¼ë¡œ ì£¼ì˜ë ¥ í–¥ìƒê³¼ ê¹Šì€ ì´ì™„"
    ]
    
    // MARK: - ê°ì •ë³„ ìµœì  ì‚¬ìš´ë“œ ë§¤ì¹­ ì‹œìŠ¤í…œ
    
    /// ê°ì • ìƒíƒœë³„ ê¶Œì¥ ì‚¬ìš´ë“œ ì¡°í•© (ì‹¬ë¦¬í•™ ì—°êµ¬ ê¸°ë°˜)
    static let emotionBasedRecommendations: [String: [Int: Float]] = [
        "ë¶ˆì•ˆ": [1: 40, 5: 70, 10: 50, 7: 30],           // ë°”ëŒ + ì‹œëƒ‡ë¬¼ + íŒŒë„ + ìš°ì£¼
        "ìŠ¤íŠ¸ë ˆìŠ¤": [0: 50, 4: 80, 5: 60, 8: 40],        // ê³ ì–‘ì´ + ë¹„ + ì‹œëƒ‡ë¬¼ + ì¿¨ë§íŒ¬
        "ìš°ìš¸": [11: 70, 3: 50, 0: 60, 1: 40],           // ìƒˆ + ë¶ˆ1 + ê³ ì–‘ì´ + ë°”ëŒ
        "ìˆ˜ë©´ê³¤ë€": [2: 80, 1: 50, 10: 70, 5: 40],        // ë°¤ + ë°”ëŒ + íŒŒë„ + ì‹œëƒ‡ë¬¼
        "ì§‘ì¤‘í•„ìš”": [6: 60, 9: 70, 8: 50, 1: 30],         // ì—°í•„ + í‚¤ë³´ë“œ + ì¿¨ë§íŒ¬ + ë°”ëŒ
        "ì°½ì˜ì„±": [6: 80, 11: 50, 5: 40, 7: 25],         // ì—°í•„ + ìƒˆ + ì‹œëƒ‡ë¬¼ + ìš°ì£¼
        "ë¶„ë…¸": [5: 90, 10: 80, 1: 60, 0: 40],           // ì‹œëƒ‡ë¬¼ + íŒŒë„ + ë°”ëŒ + ê³ ì–‘ì´
        "ì™¸ë¡œì›€": [0: 80, 11: 60, 3: 50, 4: 40],         // ê³ ì–‘ì´ + ìƒˆ + ë¶ˆ1 + ë¹„
        "í”¼ë¡œ": [2: 70, 5: 60, 10: 80, 0: 50],           // ë°¤ + ì‹œëƒ‡ë¬¼ + íŒŒë„ + ê³ ì–‘ì´
        "ê¸°ì¨": [11: 80, 1: 50, 10: 70, 5: 60]           // ìƒˆ + ë°”ëŒ + íŒŒë„ + ì‹œëƒ‡ë¬¼
    ]
    
    // MARK: - ì‹œê°„ëŒ€ë³„ ê¶Œì¥ ì‚¬ìš´ë“œ
    
    /// ì‹œê°„ëŒ€ë³„ ìµœì  ì‚¬ìš´ë“œ (ì¼ì£¼ê¸° ë¦¬ë“¬ ê³ ë ¤)
    static let timeBasedRecommendations: [String: [Int: Float]] = [
        "ìƒˆë²½": [2: 60, 1: 50, 5: 30, 12: 40],           // ë°¤ + ë°”ëŒ + ì‹œëƒ‡ë¬¼ + ë°œê±¸ìŒ-ëˆˆ
        "ì•„ì¹¨": [11: 80, 1: 40, 5: 50, 0: 30],           // ìƒˆ + ë°”ëŒ + ì‹œëƒ‡ë¬¼ + ê³ ì–‘ì´
        "ì˜¤ì „": [6: 70, 9: 60, 8: 40, 1: 30],            // ì—°í•„ + í‚¤ë³´ë“œ + ì¿¨ë§íŒ¬ + ë°”ëŒ
        "ì ì‹¬": [0: 50, 4: 40, 5: 60, 1: 30],            // ê³ ì–‘ì´ + ë¹„ + ì‹œëƒ‡ë¬¼ + ë°”ëŒ
        "ì˜¤í›„": [6: 60, 8: 50, 9: 70, 10: 40],           // ì—°í•„ + ì¿¨ë§íŒ¬ + í‚¤ë³´ë“œ + íŒŒë„
        "ì €ë…": [3: 70, 0: 60, 5: 50, 10: 40],           // ë¶ˆ1 + ê³ ì–‘ì´ + ì‹œëƒ‡ë¬¼ + íŒŒë„
        "ë°¤": [2: 80, 1: 40, 10: 70, 5: 50],             // ë°¤ + ë°”ëŒ + íŒŒë„ + ì‹œëƒ‡ë¬¼
        "ìì •": [2: 90, 10: 80, 5: 60, 1: 50]            // ë°¤ + íŒŒë„ + ì‹œëƒ‡ë¬¼ + ë°”ëŒ
    ]
    
    // MARK: - AI ì¶”ì²œ ë‹¤ì–‘ì„± ì‹œìŠ¤í…œ
    
    /// ì¶”ì²œ íŒ¨í„´ì˜ ë‹¤ì–‘ì„±ì„ ìœ„í•œ ë³€í˜• ë²„ì „ë“¤
    static let variationPatterns: [String: [[Int: Float]]] = [
        "ë¶ˆì•ˆ": [
            [1: 40, 5: 70, 10: 50, 7: 30],  // ê¸°ë³¸ - ë°”ëŒV1
            [0: 30, 5: 80, 10: 60, 1: 40],  // ê³ ì–‘ì´ ì¶”ê°€ ë²„ì „
            [1: 30, 5: 90, 10: 60, 7: 20]   // ì‹œëƒ‡ë¬¼ ê°•í™” ë²„ì „
        ],
        "ìŠ¤íŠ¸ë ˆìŠ¤": [
            [0: 50, 4: 80, 5: 60, 8: 40],   // ê¸°ë³¸ - ë¹„V1
            [0: 70, 5: 80, 10: 50, 1: 30],  // ìì—°ìŒ ì¤‘ì‹¬ - íŒŒë„V2
            [4: 60, 5: 70, 8: 50, 3: 40]    // ë¶ˆ ì¶”ê°€
        ],
        "ìˆ˜ë©´ê³¤ë€": [
            [2: 80, 1: 50, 10: 70, 5: 40],  // ê¸°ë³¸ - ë°¤V1
            [2: 90, 10: 80, 5: 50, 0: 30],  // ë°¤V2 + íŒŒë„V2
            [2: 70, 5: 80, 10: 60, 1: 40]   // ì‹œëƒ‡ë¬¼ ê°•í™”
        ],
        "ì§‘ì¤‘í•„ìš”": [
            [6: 60, 9: 70, 8: 50, 1: 30],   // ê¸°ë³¸ - í‚¤ë³´ë“œV1
            [6: 80, 8: 60, 1: 50, 4: 40],   // í‚¤ë³´ë“œV2 + ë¹„V1
            [9: 80, 8: 70, 6: 40, 5: 30]    // í‚¤ë³´ë“œV2 ê°•í™”
        ]
    ]
    
    /// ì¶”ì²œ íŒ¨í„´ì˜ ë²„ì „ ë‹¤ì–‘ì„±ì„ ìœ„í•œ ë³€í˜• ë²„ì „ë“¤
    static let variationVersions: [String: [[Int]]] = [
        "ë¶ˆì•ˆ": [
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],  // ê¸°ë³¸ V1ë“¤
            [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],  // ë°”ëŒV2 + íŒŒë„V2
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]   // ìƒˆV2
        ],
        "ìŠ¤íŠ¸ë ˆìŠ¤": [
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],  // ê¸°ë³¸ V1ë“¤
            [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],  // ë¹„V2 ì‚¬ìš©
            [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0]   // ë°”ëŒV2 + íŒŒë„V2
        ],
        "ìˆ˜ë©´ê³¤ë€": [
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],  // ê¸°ë³¸ V1ë“¤
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],  // ë°¤V2 + íŒŒë„V2
            [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]   // ë°”ëŒV2 + ë°œê±¸ìŒ-ëˆˆV2
        ],
        "ì§‘ì¤‘í•„ìš”": [
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],  // ê¸°ë³¸ V1ë“¤
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],  // í‚¤ë³´ë“œV2
            [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0]   // ë¹„V2 + í‚¤ë³´ë“œV2
        ]
    ]
    
    /// ìƒí™©ë³„ ì„¸ë¶€ ì¶”ì²œ (ì‹œê°„ëŒ€ + ê°ì • ì¡°í•©)
    static let contextualRecommendations: [String: [Int: Float]] = [
        "ì•„ì¹¨_ë¶ˆì•ˆ": [11: 60, 5: 70, 1: 30, 0: 40],      // ìƒˆ + ì‹œëƒ‡ë¬¼ + ë°”ëŒ + ê³ ì–‘ì´
        "ë°¤_ìŠ¤íŠ¸ë ˆìŠ¤": [2: 70, 0: 60, 5: 80, 10: 50],    // ë°¤ + ê³ ì–‘ì´ + ì‹œëƒ‡ë¬¼ + íŒŒë„
        "ì˜¤í›„_ì§‘ì¤‘": [6: 70, 8: 60, 9: 50, 1: 30],       // ì—°í•„ + ì¿¨ë§íŒ¬ + í‚¤ë³´ë“œ + ë°”ëŒ
        "ì €ë…_í”¼ë¡œ": [3: 80, 0: 70, 5: 60, 10: 50],      // ë¶ˆ1 + ê³ ì–‘ì´ + ì‹œëƒ‡ë¬¼ + íŒŒë„
        "ìƒˆë²½_ìˆ˜ë©´": [2: 90, 1: 40, 5: 30, 12: 50]       // ë°¤ + ë°”ëŒ + ì‹œëƒ‡ë¬¼ + ë°œê±¸ìŒ-ëˆˆ
    ]
    
    /// ìƒí™©ë³„ ì„¸ë¶€ ì¶”ì²œì˜ ë²„ì „ ì„¤ì •
    static let contextualVersions: [String: [Int]] = [
        "ì•„ì¹¨_ë¶ˆì•ˆ": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],   // ìƒˆV2
        "ë°¤_ìŠ¤íŠ¸ë ˆìŠ¤": [0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0], // ë°”ëŒV2 + ë°¤V2 + íŒŒë„V2
        "ì˜¤í›„_ì§‘ì¤‘": [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],   // í‚¤ë³´ë“œV2
        "ì €ë…_í”¼ë¡œ": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],   // íŒŒë„V2
        "ìƒˆë²½_ìˆ˜ë©´": [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]    // ë°”ëŒV2 + ë°œê±¸ìŒ-ëˆˆV2
    ]
    
    // MARK: - ì‚¬ìš´ë“œ ì¡°í•© í•„í„°ë§ ì‹œìŠ¤í…œ
    
    /// ì–´ìš¸ë¦¬ì§€ ì•ŠëŠ” ì‚¬ìš´ë“œ ì¡°í•©ë“¤ (ì¸ë±ìŠ¤ ìŒ)
    private static let incompatiblePairs: [(Int, Int)] = [
        (6, 9),   // ì—°í•„ + í‚¤ë³´ë“œ (ë‘˜ ë‹¤ ì‘ì—… ì†Œë¦¬ì—¬ì„œ ê²¹ì¹¨)
        (3, 8),   // ë¶ˆ1 + ì¿¨ë§íŒ¬ (ë”°ëœ»í•¨ vs ì°¨ê°€ì›€ì˜ ëŒ€ì¡°)
        (0, 9),   // ê³ ì–‘ì´ + í‚¤ë³´ë“œ (ìì—° vs ì¸ê³µì˜ ê·¹ëª…í•œ ëŒ€ì¡°)
        (7, 6),   // ìš°ì£¼ + ì—°í•„ (ëª…ìƒ vs ì§‘ì¤‘ ì‘ì—…ì˜ ì¶©ëŒ)
        (7, 9)    // ìš°ì£¼ + í‚¤ë³´ë“œ (ëª…ìƒ vs ì¸ê³µ ì†Œë¦¬ì˜ ì¶©ëŒ)
    ]
    
    /// ê°•ë ¥í•˜ê²Œ ì–´ìš¸ë¦¬ì§€ ì•ŠëŠ” ì¡°í•© (ì™„ì „íˆ ì°¨ë‹¨)
    private static let stronglyIncompatiblePairs: [(Int, Int)] = [
        (0, 9),   // ê³ ì–‘ì´ + í‚¤ë³´ë“œ (ìì—° vs ê¸°ê³„ìŒì˜ ê·¹ëª…í•œ ëŒ€ì¡°)
        (3, 8)    // ë¶ˆ1 + ì¿¨ë§íŒ¬ (ë”°ëœ»í•¨ vs ì‹œì›í•¨ì˜ ì •ë°˜ëŒ€)
    ]
    
    /// ì‹œë„ˆì§€ íš¨ê³¼ê°€ ìˆëŠ” ìŒì› ì¡°í•©ë“¤
    static let synergyPairs: [(Int, Int, Float)] = [
        (5, 10, 1.2),  // ì‹œëƒ‡ë¬¼ + íŒŒë„ (ë¬¼ ì†Œë¦¬ ì‹œë„ˆì§€)
        (0, 3, 1.3),   // ê³ ì–‘ì´ + ë¶ˆ1 (í¸ì•ˆí•¨ì˜ ì™„ë²½í•œ ì¡°í•©)
        (6, 8, 1.2),   // ì—°í•„ + ì¿¨ë§íŒ¬ (ì§‘ì¤‘ ì‘ì—… í™˜ê²½)
        (4, 5, 1.15),  // ë¹„ + ì‹œëƒ‡ë¬¼ (ë¬¼ ì†Œë¦¬ ì¡°í•©)
        (1, 5, 1.1),   // ë°”ëŒ + ì‹œëƒ‡ë¬¼ (ìì—° ì¡°í•©)
        (11, 12, 1.1)  // ìƒˆ + ë°œê±¸ìŒ-ëˆˆ (ìì—° í™˜ê²½ìŒ)
    ]
    
    /// ë³¼ë¥¨ ë°°ì—´ì— ì¡°í•© í•„í„°ë§ ì ìš©
    static func applyCompatibilityFilter(to volumes: [Float]) -> [Float] {
        var filteredVolumes = volumes
        
        // ê°•ë ¥í•œ ë¹„í˜¸í™˜ ì¡°í•© ì²´í¬ (í•œ ìª½ì„ 0ìœ¼ë¡œ ë§Œë“¦)
        for (index1, index2) in stronglyIncompatiblePairs {
            if filteredVolumes[index1] > 0 && filteredVolumes[index2] > 0 {
                // ë” ì‘ì€ ë³¼ë¥¨ì„ 0ìœ¼ë¡œ ë§Œë“¦
                if filteredVolumes[index1] < filteredVolumes[index2] {
                    filteredVolumes[index1] = 0
                } else {
                    filteredVolumes[index2] = 0
                }
            }
        }
        
        // ì¼ë°˜ ë¹„í˜¸í™˜ ì¡°í•© ì²´í¬ (ë³¼ë¥¨ì„ ì¤„ì„)
        for (index1, index2) in incompatiblePairs {
            if filteredVolumes[index1] > 0 && filteredVolumes[index2] > 0 {
                filteredVolumes[index1] *= 0.7
                filteredVolumes[index2] *= 0.7
            }
        }
        
        // ì‹œë„ˆì§€ íš¨ê³¼ ì ìš©
        for (index1, index2, multiplier) in synergyPairs {
            if filteredVolumes[index1] > 0 && filteredVolumes[index2] > 0 {
                filteredVolumes[index1] = min(100, filteredVolumes[index1] * multiplier)
                filteredVolumes[index2] = min(100, filteredVolumes[index2] * multiplier)
            }
        }
        
        return filteredVolumes
    }
    
    // MARK: - ê°œì„ ëœ í”„ë¦¬ì…‹ ì¶”ì²œ ì‹œìŠ¤í…œ
    
    /// ê°ì •ë³„ ë‹¤ì–‘í•œ í”„ë¦¬ì…‹ íŒ¨í„´ë“¤ (ë”ìš± ì„¸ë¶„í™”)
    static let emotionBasedPresets: [String: [(name: String, volumes: [Float], description: String, versions: [Int])]] = [
        "ë¶ˆì•ˆ": [
            (
                name: "ê³ ìš”í•œ ë°”ëŒì˜ í¬ì˜¹",
                volumes: [30, 60, 20, 0, 0, 70, 0, 15, 0, 0, 40, 0, 0], // ê³ ì–‘ì´, ë°”ëŒV2, ì‹œëƒ‡ë¬¼, ìš°ì£¼, íŒŒë„
                description: "ë¶€ë“œëŸ¬ìš´ ë°”ëŒê³¼ ìì—°ìŒì´ ë§ˆìŒì„ ì•ˆì •ì‹œì¼œì¤ë‹ˆë‹¤. ë¶ˆì•ˆí•œ ë§ˆìŒì„ ì°¨ë¶„í•˜ê²Œ ë‹¬ë˜ì£¼ëŠ” ì¡°í•©ì´ì—ìš”.",
                versions: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] // ë°”ëŒV2
            ),
            (
                name: "ìƒˆë²½ ê³ ì–‘ì´ì˜ ìœ„ë¡œ",
                volumes: [60, 40, 0, 0, 0, 50, 0, 10, 0, 0, 30, 20, 0], // ê³ ì–‘ì´, ë°”ëŒV1, ì‹œëƒ‡ë¬¼, ìƒˆV1, íŒŒë„V1
                description: "ê³ ì–‘ì´ì˜ ë”°ëœ»í•œ ê³¨ê³¨ê±°ë¦¼ê³¼ ìƒˆë²½ ìƒˆì†Œë¦¬ê°€ ë¶ˆì•ˆì„ ë‹¬ë˜ì¤ë‹ˆë‹¤.",
                versions: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] // ëª¨ë‘ V1
            )
        ],
        "ìŠ¤íŠ¸ë ˆìŠ¤": [
            (
                name: "ë¹„ë‚´ë¦¬ëŠ” ì°½ê°€ì˜ í‰ì˜¨",
                volumes: [40, 30, 0, 20, 70, 60, 0, 0, 30, 0, 0, 0, 0], // ê³ ì–‘ì´, ë°”ëŒ, ë¶ˆ1, ë¹„V2, ì‹œëƒ‡ë¬¼, ì¿¨ë§íŒ¬
                description: "ì°½ë¬¸ì— ë–¨ì–´ì§€ëŠ” ë¹—ë°©ìš¸ ì†Œë¦¬ì™€ ë”°ëœ»í•œ ë¶ˆì†Œë¦¬ê°€ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë…¹ì—¬ì¤ë‹ˆë‹¤.",
                versions: [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0] // ë¹„V2
            ),
            (
                name: "ìˆ²ì† ì˜¤í›„ì˜ íœ´ì‹",
                volumes: [50, 40, 0, 30, 0, 80, 0, 0, 0, 0, 50, 40, 20], // ê³ ì–‘ì´, ë°”ëŒ, ë¶ˆ1, ì‹œëƒ‡ë¬¼, íŒŒë„, ìƒˆ, ë°œê±¸ìŒ-ëˆˆ
                description: "ê¹Šì€ ìˆ²ì—ì„œ ëŠë¼ëŠ” ì™„ì „í•œ ì´ì™„ê°. ëª¨ë“  ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ìì—° ì†ìœ¼ë¡œ ì‚¬ë¼ì§‘ë‹ˆë‹¤.",
                versions: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1] // ìƒˆV2, ë°œê±¸ìŒ-ëˆˆV2
            )
        ],
        "ìˆ˜ë©´ê³¤ë€": [
            (
                name: "ìì •ì˜ ê¹Šì€ ê³ ìš”",
                volumes: [20, 50, 80, 0, 30, 40, 0, 0, 0, 0, 60, 0, 30], // ê³ ì–‘ì´, ë°”ëŒV2, ë°¤V2, ë¹„V1, ì‹œëƒ‡ë¬¼, íŒŒë„V2, ë°œê±¸ìŒ-ëˆˆV2
                description: "ë°¤ì˜ ê³ ìš”í•¨ê³¼ ë©€ë¦¬ì„œ ë“¤ë¦¬ëŠ” ìì—°ìŒì´ ê¹Šì€ ì ìœ¼ë¡œ ì´ëŒì–´ì¤ë‹ˆë‹¤.",
                versions: [0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1] // ë°”ëŒV2, ë°¤V2, íŒŒë„V2, ë°œê±¸ìŒ-ëˆˆV2
            ),
            (
                name: "íŒŒë„ê°€ ë“¤ë ¤ì˜¤ëŠ” ë°¤",
                volumes: [30, 60, 70, 0, 0, 50, 0, 0, 0, 0, 80, 0, 0], // ê³ ì–‘ì´, ë°”ëŒV2, ë°¤V1, ì‹œëƒ‡ë¬¼, íŒŒë„V2
                description: "í•´ë³€ì˜ íŒŒë„ì†Œë¦¬ì™€ ë°¤ ê·€ëšœë¼ë¯¸ê°€ ë§Œë“œëŠ” ì™„ë²½í•œ ìˆ˜ë©´ í™˜ê²½ì…ë‹ˆë‹¤.",
                versions: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0] // ë°”ëŒV2, íŒŒë„V2
            )
        ],
        "ì§‘ì¤‘í•„ìš”": [
            (
                name: "ì„œì¬ì˜ ì§‘ì¤‘ ëª¨ë“œ",
                volumes: [0, 20, 0, 0, 0, 30, 60, 0, 40, 70, 0, 0, 0], // ë°”ëŒV2, ì‹œëƒ‡ë¬¼, ì—°í•„, ì¿¨ë§íŒ¬, í‚¤ë³´ë“œV1
                description: "ì¡°ìš©í•œ ì„œì¬ ë¶„ìœ„ê¸°ë¡œ ì§‘ì¤‘ë ¥ì„ ê·¹ëŒ€í™”í•˜ëŠ” ì‚¬ìš´ë“œ ì¡°í•©ì…ë‹ˆë‹¤.",
                versions: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] // ë°”ëŒV2, í‚¤ë³´ë“œV1
            ),
            (
                name: "í˜„ëŒ€ì  ì‘ì—… ê³µê°„",
                volumes: [0, 30, 0, 0, 0, 0, 50, 0, 60, 80, 0, 0, 0], // ë°”ëŒV1, ì—°í•„, ì¿¨ë§íŒ¬, í‚¤ë³´ë“œV2
                description: "ë¹ ë¥¸ ì—…ë¬´ ì²˜ë¦¬ë¥¼ ìœ„í•œ ë¦¬ë“¬ê° ìˆëŠ” í˜„ëŒ€ì  ì‘ì—… í™˜ê²½ìŒì…ë‹ˆë‹¤.",
                versions: [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0] // í‚¤ë³´ë“œV2
            )
        ],
        "ìš°ìš¸": [
            (
                name: "ë”°ëœ»í•œ ì•„ì¹¨ì˜ ì‹œì‘",
                volumes: [60, 40, 0, 40, 0, 30, 0, 0, 0, 0, 0, 70, 50], // ê³ ì–‘ì´, ë°”ëŒV1, ë¶ˆ1, ì‹œëƒ‡ë¬¼, ìƒˆV1, ë°œê±¸ìŒ-ëˆˆV1
                description: "ë°ì€ ìƒˆì†Œë¦¬ì™€ í™œê¸°ì°¬ ìì—°ìŒì´ ìš°ìš¸í•œ ê¸°ë¶„ì„ ë°ê²Œ ì „í™”í•´ì¤ë‹ˆë‹¤.",
                versions: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] // ëª¨ë‘ V1 (í™œê¸°ì°¬ ë²„ì „)
            ),
            (
                name: "í–‡ì‚´ ê°€ë“í•œ ìˆ²ê¸¸",
                volumes: [50, 50, 0, 30, 0, 60, 20, 0, 0, 0, 40, 80, 60], // ê³ ì–‘ì´, ë°”ëŒ, ë¶ˆ1, ì‹œëƒ‡ë¬¼, ì—°í•„, íŒŒë„, ìƒˆV1, ë°œê±¸ìŒ-ëˆˆV1
                description: "ìˆ²ê¸¸ì„ ê±¸ìœ¼ë©° ë“£ëŠ” ìƒë™ê° ë„˜ì¹˜ëŠ” ìì—°ìŒë“¤ì´ í¬ë§ì„ ë¶ˆì–´ë„£ì–´ì¤ë‹ˆë‹¤.",
                versions: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] // ëª¨ë‘ V1
            )
        ],
        "í‰ì˜¨": [
            (
                name: "ê· í˜•ì¡íŒ í•˜ë£¨",
                volumes: [40, 40, 30, 20, 20, 50, 20, 5, 20, 20, 30, 30, 20], // ëª¨ë“  ìš”ì†Œ ê· í˜•ìˆê²Œ
                description: "ëª¨ë“  ì‚¬ìš´ë“œê°€ ì¡°í™”ë¡­ê²Œ ì–´ìš°ëŸ¬ì§„ ì™„ë²½í•œ ê· í˜•ê°ì„ ì œê³µí•©ë‹ˆë‹¤.",
                versions: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] // ê¸°ë³¸ ë²„ì „ë“¤
            ),
            (
                name: "ìì—°ì˜ ì™„ì „í•œ ì¡°í™”",
                volumes: [30, 50, 40, 25, 35, 60, 0, 8, 0, 0, 45, 40, 35], // ìì—°ìŒ ì¤‘ì‹¬
                description: "ìˆœìˆ˜í•œ ìì—°ìŒë“¤ë§Œìœ¼ë¡œ êµ¬ì„±ëœ ì™„ë²½í•œ í‰ì˜¨ê°ì„ ì„ ì‚¬í•©ë‹ˆë‹¤.",
                versions: [0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1] // ìì—°ìŒì€ V2ë¡œ (ë” ë¶€ë“œëŸ½ê²Œ)
            )
        ]
    ]

    /// ì‹œê°„ëŒ€ë³„ ì¶”ì²œ ìˆ˜ì •ì
    static let timeBasedModifiers: [String: (volumeMultiplier: Float, preferredVersions: [Int])] = [
        "ìƒˆë²½": (volumeMultiplier: 0.7, preferredVersions: [0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1]), // ë¶€ë“œëŸ¬ìš´ ë²„ì „ë“¤
        "ì•„ì¹¨": (volumeMultiplier: 1.0, preferredVersions: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]), // í™œê¸°ì°¬ V1ë“¤
        "ì˜¤ì „": (volumeMultiplier: 0.9, preferredVersions: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]),
        "ì ì‹¬": (volumeMultiplier: 0.8, preferredVersions: [0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0]),
        "ì˜¤í›„": (volumeMultiplier: 1.0, preferredVersions: [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0]), // í‚¤ë³´ë“œV2ë¡œ ì§‘ì¤‘ë ¥
        "ì €ë…": (volumeMultiplier: 0.9, preferredVersions: [0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1]),
        "ë°¤": (volumeMultiplier: 0.8, preferredVersions: [0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1]), // ë¶€ë“œëŸ¬ìš´ ë²„ì „ë“¤
        "ìì •": (volumeMultiplier: 0.6, preferredVersions: [0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1])
    ]

    /// ê°œì„ ëœ ì¶”ì²œ ì‹œìŠ¤í…œ
    static func getRecommendedPreset(
        emotion: String? = nil,
        timeOfDay: String? = nil,
        previousRecommendations: [String] = [],
        intensity: Float = 1.0
    ) -> (name: String, volumes: [Float], description: String, versions: [Int]) {
        
        let targetEmotion = emotion ?? "í‰ì˜¨"
        let currentTime = timeOfDay ?? "ì˜¤í›„"
        
        // 1. í•´ë‹¹ ê°ì •ì˜ í”„ë¦¬ì…‹ë“¤ ê°€ì ¸ì˜¤ê¸°
        let availablePresets = emotionBasedPresets[targetEmotion] ?? emotionBasedPresets["í‰ì˜¨"]!
        
        // 2. ì´ì „ì— ì¶”ì²œí•˜ì§€ ì•Šì€ ê²ƒ ì¤‘ì—ì„œ ì„ íƒ (ë‹¤ì–‘ì„± ë³´ì¥)
        let unusedPresets = availablePresets.filter { preset in
            !previousRecommendations.contains(preset.name)
        }
        
        let selectedPresets = unusedPresets.isEmpty ? availablePresets : unusedPresets
        let basePreset = selectedPresets.randomElement()!
        
        // 3. ì‹œê°„ëŒ€ì— ë”°ë¥¸ ì¡°ì •
        var adjustedVolumes = basePreset.volumes
        var adjustedVersions = basePreset.versions
        
        if let timeModifier = timeBasedModifiers[currentTime] {
            // ë³¼ë¥¨ ì¡°ì •
            adjustedVolumes = adjustedVolumes.map { $0 * timeModifier.volumeMultiplier * intensity }
            
            // ë²„ì „ ì¡°ì • (ì‹œê°„ëŒ€ì— ë§ëŠ” ë²„ì „ìœ¼ë¡œ)
            for (index, preferredVersion) in timeModifier.preferredVersions.enumerated() {
                if index < adjustedVersions.count {
                    adjustedVersions[index] = preferredVersion
                }
            }
        }
        
        // 4. ìµœì¢… ì´ë¦„ì— ì‹œê°„ëŒ€ ì •ë³´ ì¶”ê°€
        let timePrefixes: [String: String] = [
            "ìƒˆë²½": "ìƒˆë²½ì˜ ",
            "ì•„ì¹¨": "ì•„ì¹¨ì˜ ",
            "ë°¤": "ë°¤ì˜ ",
            "ìì •": "ìì •ì˜ "
        ]
        
        let finalName = (timePrefixes[currentTime] ?? "") + basePreset.name
        
        return (
            name: finalName,
            volumes: adjustedVolumes,
            description: basePreset.description,
            versions: adjustedVersions
        )
    }
}
